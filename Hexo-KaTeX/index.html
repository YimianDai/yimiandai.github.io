<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/><meta content="telephone=no" name="format-detection"/><meta name="description"/><title>Hexo 博客支持 KaTeX（回炉版） | Grok</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"/><link rel="stylesheet" type="text/css" href="/css/highlight.css"/><link rel="stylesheet" type="text/css" href="/css/font.css"/><link rel="stylesheet" type="text/css" href="/css/noise.css"/><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"/><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"/></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Hexo/">Hexo</a><a class="post-tag-link" href="/tags/KaTeX/">KaTeX</a></div><div class="post-time">2016-12-06</div></div></div><div class="container post-header"><h1>Hexo 博客支持 KaTeX（回炉版）</h1></div><div class="container post-content"><p>去年的这个时候，我写过一篇同样目的的文章 <a href="http://lowrank.cn/post/hexo-katex" target="_blank" rel="noopener">《Hexo 博客支持 KaTeX》</a>。当时虽然搞成了，但基本属于误打误撞的状态，对于为什么要这些步骤并不知晓，仅仅像是一个操作工，这种感觉很不好，所以才有了这一篇回炉版的Hexo 博客支持 KaTeX 教程。</p>
<a id="more"></a>
<h2 id="1-什么是-KaTeX"><a href="#1-什么是-KaTeX" class="headerlink" title="1. 什么是 KaTeX"></a>1. 什么是 KaTeX</h2><p>KaTeX 是一个支持在网页上显示 TeX 公式的 JavaScript 库，相较于其更加有名的前辈 MathJax，KaTeX 最大的特点是渲染速度更快。读者可以在 <a href="http://www.intmath.com/cg5/katex-mathjax-comparison.php" target="_blank" rel="noopener">KaTeX and MathJax Comparison Demo</a> 上感受下两者速度的差别，在我电脑上，KaTeX 渲染完所有公式仅用了 118 毫秒，而 MathJax 用了 15708 毫秒，后者是前者的一百多倍。</p>
<p>当然，这种快速、轻量级的权衡，肯定会有一定的牺牲，相较于 MathJax，KaTeX 支持的符号相对较少一些。<a href="https://github.com/Khan/KaTeX/wiki/Function-Support-in-KaTeX" target="_blank" rel="noopener">Function Support in KaTeX</a> 列出了 KaTeX 支持的符号和环境，可以看到，对于绝大部分需求，KaTeX 已经能够满足需求了。去年12月我写第一版的时候，KaTeX 还是不支持 $\nabla$ 的，现在可以了。不过对于 <code>\hat{x}\ \vec{x}\ \ddot{x}\ \overrightarrow{AB}</code> 还是不可以。</p>
<h2 id="2-如何让-Hexo-博客支持-KaTeX？"><a href="#2-如何让-Hexo-博客支持-KaTeX？" class="headerlink" title="2. 如何让 Hexo 博客支持 KaTeX？"></a>2. 如何让 Hexo 博客支持 KaTeX？</h2><p>默认已经完成 Hexo 博客搭建了，如果还没有，可以看我的上一篇文章 <a href="http://lowrank.science/Hexo-KaTeX/">《知行合一的 Hexo 博客搭建教程》</a>。 过程主要分为两大块：添加 katex.min.js 和 安装 katex.min.css、hexo-katex 插件。</p>
<h3 id="2-1-添加-katex-min-js-和-katex-min-css"><a href="#2-1-添加-katex-min-js-和-katex-min-css" class="headerlink" title="2.1 添加 katex.min.js 和 katex.min.css"></a>2.1 添加 katex.min.js 和 katex.min.css</h3><p>根据 KaTeX 的官方文档 <a href="https://github.com/Khan/KaTeX#usage" target="_blank" rel="noopener">https://github.com/Khan/KaTeX#usage</a>，我们需要在生成网页的 HTML  里添加如下两行代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>但在 Hexo 中，如果我们改动了原来的 markdown 文件，经常会使用 <code>hexo clean</code> 命令来清空以前生成的 HTML 文件，然后再用 <code>hexo generate</code> 来生成新的，每一次都要直接在 HTML 里面加入这两行代码会累死人的。好在 Hexo 是根据模板来生成 HTML 的，所以我们只要将这两行代码放到模板文件去。不同的模板不一样，这里分别以默认主题 <a href="https://github.com/hexojs/hexo-theme-landscape" target="_blank" rel="noopener">Landscape</a> 和本站采用的 <a href="https://github.com/lotabout/hexo-theme-noise" target="_blank" rel="noopener">Noise</a> 为例，其他情形如法炮制。</p>
<h4 id="2-1-1-Landscape-主题"><a href="#2-1-1-Landscape-主题" class="headerlink" title="2.1.1 Landscape 主题"></a>2.1.1 Landscape 主题</h4><p>在 Hexo 站点的本地文件夹下的 <code>\themes\landscape\layout\_partial</code> 文件夹下可以看到有很多 <code>ejs</code> 文件。EJS 是一个 JavaScript 模板库，用来从 JSON 数据中生成 HTML 字符串。我们要挑一个会在网站首页和每篇文章的网页上都存在的部件来添加这两行代码，参考 MathJax 的做法，我们也选择 <code>_partial</code> 文件夹下的 <code>after-footer.ejs</code> 文件。虽然不懂 <code>ejs</code>，但从 <code>after-footer.ejs</code> 的如下代码可以知道</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p> <code>ejs</code> 中的 JavaScript 和 CSS 的写法还是和 HTML 一样的，所以我们直接把上面的那两行代码复制到 <code>after-footer.ejs</code> 最后即可。</p>
<h4 id="2-1-2-Noise-主题"><a href="#2-1-2-Noise-主题" class="headerlink" title="2.1.2 Noise 主题"></a>2.1.2 Noise 主题</h4><p>假设已经安装好了Noise 主题，在 <code>\themes\noise\layout\_partial</code> 文件夹下找不到熟悉的 <code>after-footer.ejs</code> 文件了，而且<code>\themes\noise\layout</code> 下一个 <code>ejs</code> 文件都没有，都是 <code>jade</code> 文件。<code>jade</code> 用途同 <code>ejs</code> 一样，是另一种模板引擎。打开 <code>base.jade</code> 看一下，囧了，JavaScript 和 CSS 的写法和 HTML 不一样。不过只要细心一点肯定能发现，<code>base.jade</code> 里面有如下的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">link(rel=&apos;stylesheet&apos;, type=&apos;text/css&apos;, 	 href=&quot;//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css&quot;)</span><br><span class="line">script(src=&quot;//cdn.bootcss.com/jquery/2.0.3/jquery.min.js&quot;)</span><br></pre></td></tr></table></figure>
<p>这不就是 CSS 和 JavaScript 的用法么？所以我们只要照葫芦画瓢就行了，把要添加的那两行 KaTeX 改写一下，在上面两行代码的下面添加如下两行代码即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// For KaTeX Begin</span><br><span class="line">link(rel=&apos;stylesheet&apos;, type=&apos;text/css&apos;, href=&quot;//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.css&quot;)</span><br><span class="line">script(src=&quot;//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.js&quot;)</span><br><span class="line">// For KaTeX End</span><br></pre></td></tr></table></figure>
<p>其中，<code>//</code> 开头的是注释。</p>
<p>至此，在模板文件中添加 katex.min.js 和 katex.min.css 的任务算是完成了。那是否可以直接用了呢？我们可以测试一下。在现有的 markdown 文件中添加一行 <code>$E = m * c^2$</code>，依次运行 <code>hexo clean</code>、<code>hexo generate</code>、<code>`hexo server</code>， 到 <a href="http://localhost:4000/" target="_blank" rel="noopener">http://localhost:4000/</a> 里去看一下，会发现 <code>$E = m * c^2$</code> 是纯文本，并没有显示出数学公式。嗯？回想一下，诚然，我们知道这是一行数学公式，但 Hexo 不知道啊，怎么才能让 Hexo 在从 Markdown 转成 HTML 的时候，知道这是数学公式，调用 KaTeX 来渲染呢？这就还需要下一步。</p>
<h3 id="2-2-安装-hexo-katex-插件"><a href="#2-2-安装-hexo-katex-插件" class="headerlink" title="2.2 安装 hexo-katex 插件"></a>2.2 安装 hexo-katex 插件</h3><p>Github 上有一个 hexo-katex 插件，可以帮助我们在 Hexo 站点中使用 KaTeX，根据其<a href="https://github.com/thcd/hexo-katex" target="_blank" rel="noopener">项目主页</a>以及  hexo-katex 依赖的 <a href="https://github.com/wzpan/hexo-renderer-pandoc" target="_blank" rel="noopener">hexo-render-pandoc</a> 安装过程有如下几步</p>
<ul>
<li><p><strong>Step 1: </strong> 安装神器 <a href="https://github.com/wzpan/hexo-renderer-pandoc" target="_blank" rel="noopener">Pandoc</a>，下载地址为<a href="https://github.com/wzpan/hexo-renderer-pandoc" target="_blank" rel="noopener">https://github.com/wzpan/hexo-renderer-pandoc</a></p>
</li>
<li><p><strong>Step 2:</strong>  cd 到 Hexo 博客所在的文件夹，敲入如下命令，等待安装完成</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-renderer-pandoc --save</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Step 3:</strong>  修改 <code>/node_modules/hexo-render-pandoc/index.js</code>，将 <code>var args = [ &#39;-f&#39;, &#39;markdown&#39;, &#39;-t&#39;, &#39;html&#39;, &#39;--mathjax&#39;, &#39;--smart&#39;]</code> 中的 <code>mathjax</code> 替换为 <code>katex</code>，即</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var args = [ '-f', 'markdown', '-t', 'html', '--mathjax', '--smart']</span></span><br><span class="line"><span class="keyword">var</span> args = [ <span class="string">'-f'</span>, <span class="string">'markdown'</span>, <span class="string">'-t'</span>, <span class="string">'html'</span>, <span class="string">'--katex'</span>, <span class="string">'--smart'</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Step 4:</strong>  仍然在 Hexo 博客所在的文件夹，在终端 或者 cmd 中敲入如下命令，等待安装完成。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-katex --save</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>​至此，Hexo 博客支持 KaTeX 的所有步骤都已经结束。可以依次运行 <code>hexo clean</code>、<code>hexo generate</code>、<code>`hexo server</code>， 到 <a href="http://localhost:4000/" target="_blank" rel="noopener">http://localhost:4000/</a> 里去看一下，应该能够将 <code>$E = m * c^2$</code> 正确显示成 $E = m <em> c^2$。如果运行 <code>hexo generate</code> 的时候报错，不要紧，把 cmd 关掉重新打开就好，应该是 Pandoc 或者这两个插件 是在 cmd 打开之后安装的缘故。不添加 <code>katex.min.js</code> 和 <code>katex.min.css</code>，单独安装 <code>hexo-katex</code> 插件，会显示成 `E = m </em> c^2E=m∗c2 <code>，也不行，所以添加</code>katex.min.js<code>、</code>katex.min.css<code>和安装</code>hexo-katex` 插件这两步一步都不能少。</p>
<h2 id="3-存在的问题"><a href="#3-存在的问题" class="headerlink" title="3. 存在的问题"></a>3. 存在的问题</h2><p><a href="https://github.com/thcd/hexo-katex" target="_blank" rel="noopener">hexo-katex 主页</a> 上提供的信息很少，Inline math 用<code>$</code> 括起来，Display math 用 <code>$$</code> 括起来，具体形式如下：</p>
<p>Inline math <code>$E = m * c^2$</code></p>
<p>Display math</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$$</span><br><span class="line">E = m * c^2</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>
<p>对于简单的式子没问题，但我随便挑了三个例子，问题就来了。</p>
<h5 id="Case-definitions"><a href="#Case-definitions" class="headerlink" title="Case definitions"></a>Case definitions</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$$</span><br><span class="line">f(n) = \begin&#123;cases&#125; \frac&#123;n&#125;&#123;2&#125;, &amp;amp; \text&#123;if &#125; n\text&#123; is even&#125; \\ 3n+1, &amp; \text&#123;if &#125; n\text&#123; is odd&#125; \end&#123;cases&#125;</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>
<p>$$f(n) = \begin{cases} \frac{n}{2}, &amp; \text{if } n\text{ is even} \ 3n+1, &amp; \text{if } n\text{ is odd} \end{cases}$$</p>
<h5 id="Matrices"><a href="#Matrices" class="headerlink" title="Matrices"></a>Matrices</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$$</span><br><span class="line">\begin&#123;pmatrix&#125;a_&#123;11&#125; &amp; a_&#123;12&#125; &amp; a_&#123;13&#125;\\ a_&#123;21&#125; &amp; a_&#123;22&#125; &amp; a_&#123;23&#125;\\ a_&#123;31&#125; &amp; a_&#123;32&#125; &amp; a_&#123;33&#125;\end&#123;pmatrix&#125;</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>
<p>$$<br>\begin{pmatrix}a<em>{11} &amp; a</em>{12} &amp; a<em>{13}\ a</em>{21} &amp; a<em>{22} &amp; a</em>{23}\ a<em>{31} &amp; a</em>{32} &amp; a_{33}\end{pmatrix}<br>$$</p>
<h5 id="Multi-line-function"><a href="#Multi-line-function" class="headerlink" title="Multi-line function"></a>Multi-line function</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$$</span><br><span class="line">\begin&#123;array&#125;&#123;lcl&#125;z &amp; = &amp; a \\f(x,y,z) &amp; = &amp; x + y + z\end&#123;array&#125;</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>
<p>$$<br>\begin{array}{lcl}z &amp; = &amp; a \f(x,y,z) &amp; = &amp; x + y + z\end{array}<br>$$</p>
<p>啊啊啊！用来对齐的 <code>&amp;</code> 符号会被显示成 <code>amp;</code>，但其对排版的作用又是起到的。这些例子，在用 KaTeX 渲染的其他网页上都是正常的，所以应该是 <code>hexo-renderer-pandoc</code> 和 <code>hexo-katex</code> 中间有某一个出问题了。独自解决这个问题，超过我目前的能力范围。我在 <code>hexo-katex</code> 的 Github 主页上提了一个 issue <a href="https://github.com/thcd/hexo-katex/issues/1" target="_blank" rel="noopener">&amp;-alignment markers get displayed as “amp;”</a>，希望 <code>hexo-katex</code> 作者能够给出解答，不过希望不是很大。最近，还没有写要用到 LaTeX 的文章的打算，即使写了也不会大量用到 <code>&amp;</code> 符号，所以就暂且凑合着。万一要用到了怎么办，目前想得就只有两条路了：</p>
<ul>
<li>还是切回 MathJax，看看能不能自己搭 CDN，加载快一点。</li>
<li>用 KLatexFormula 生成图片，上传图床凑合下。</li>
</ul>
<p>感谢您一直阅读到这里，如果我的文章有错误或不足之处，请务必在评论中留言指出，千万不用客气，万分感谢~</p>
</div></div><div class="post-main post-comment"><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'YimianDai';
var disqus_identifier = 'Hexo-KaTeX/';
var disqus_title = 'Hexo 博客支持 KaTeX（回炉版）';
var disqus_url = 'http://lowrank.science/Hexo-KaTeX/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"/><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
e=o.createElement(i);r=o.getElementsByTagName(i)[0];
e.src='//www.google-analytics.com/analytics.js';
r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-88794833-1');ga('send','pageview');</script></body></html>